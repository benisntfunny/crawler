{
    "id": "24bc98febd16c82f661443f8bb0257a93fe7c0f907c06ed57f1c94918feab796-part2",
    "url": "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_product_index_batch_size.htm&language=en_US&type=5",
    "content": "nullSalesforce B2B Commerce for Visualforce\nTABLE OF CONTENTS\nClose\nClose\nSearch\nSearch\n Salesforce B2B Commerce for Visualforce\n Get Started with B2B Commerce for Visualforce\n Manage Storefront Details and Metadata\n Set Up Product Data for B2B Commerce for Visualforce\n Help Buyers Discover Products on Your Storefront\n Organize Products into Categories for B2B Commerce for Visualforce\n Define Product Specs and Create Product List Page Filters\n Maintain Product Index Records\n Monitor and Automate Product Index Batch Jobs\n View Product Index Records from a Report\n Values for Product Index Status\n Strategies for Managing Price List Item Currencies with Product...\n Implement the Primary Index for All Currencies Strategy for Product...\n Control the Size of Each Product Index Batch Job\n Extend the Default Product Index Object to Include Other Fields\n Price and Sell Products for B2B Commerce for Visualforce\n Support Buyer Accounts for B2B Commerce for Visualforce\n Provide a Smooth Path to Purchase for Storefront Buyers\n Customize the Storefront User Experience\n Strategize for Storefront Success\n Deliver Storefront Performance and Security\n Market Templates for B2B Commerce for Visualforce\n Solution Resources for B2B Commerce for Visualforce\n\nYou are here:\n\nSALESFORCE HELP\nDOCS\nVISUALFORCE B2B COMMERCE\nControl the Size of Each Product Index Batch Job\n\nIf your storefront includes products with a significant number of price list items, the product index batch jobs can sometimes reach Apex governor limits. These limits can exclude some products from having product index records created, which can result in an unintentionally incomplete or out-of-date product catalog. To maintain buyer trust in your product data and avoid Apex governor limits, you can more precisely control the size of each product index batch job.\n\nREQUIRED EDITIONS AND USER PERMISSIONS\nSalesforce CompatibilitySalesforce not available in all orgs) and Lightning Experience for Enterprise, Performance, Unlimited, and Developer editions.\n\n\nB2B Commerce Compatibility\n\nB2B Commerce for Visualforce Winter ’21 (version 4.13) or later\nB2B Commerce for Visualforce Spring ’20 (version 4.12) patch 3.147.7 or later\nB2B Commerce for Visualforce Summer ’18 (version 4.9) patch 3.136.39 or later\n\n\nUSER PERMISSIONS NEEDED\nTo access CC Admin and change settings:\tAccess B2B Commerce for Visualforce Admin Settings permission set\n\nBy default, the ccrz.ccProductIndexBuilder.build utility method determines the number of products to evaluate in each product index batch job using the following formula:\n\n200/(Number of locales + 1)\n\nWhat do these values mean?\n\nThe 200 value is an arbitrary default starting point.\nThe Number of locales variable considers both specific and generic fallback locales. For example, if your storefront defines two specific locales (en_US and ja_JP), then this variable also considers their respective fallback locales (en and ja). In this example, the Number of locales variable evaluates to 4.\nThe + 1 value accounts for a query of ccrz__E_ProductIndex__c records.\n\nUsing this example, each product index batch job evaluates a batch size of 40 products: the result of 200/(4 + 1). The number of corresponding price list items evaluated in that batch job depends on how many price list items exist for those 40 products. Consider the following factors and how they can increase the number of price list items for each product:\n\nComplicated buyer entitlements, where you define multiple price list items in the same currency for one product, but for different account groups.\nMultiple enabled currencies for an internationalized storefront.\n\nWhen a batch job tries to evaluate more than 50,000 price list items at one time, you exceed Apex governor limits. Any product whose price list items are out of scope of the first 50,000 records don't have product index records created. As a result, your storefront shows incomplete and out-of-date product information.\n\nNOTE For more information about how locales and currencies affect the number of created product index records, see Strategies for Managing Price List Item Currencies with Product Index Records.\n\nTo avoid Apex governor limits and ensure that your product data is complete, you can override the default batch size calculation with a custom value. To determine the correct batch size for your storefront:\n\nReview your products that have the most price list items. Consider sorting your product records by the number of price list items, from most to least.\nSelect a batch size that ensures that any given batch job never exceeds 50,000 price list items at one time. For example, let's say that the products with the most price list items each have 10,000 price list items. To ensure that no batch job exceeds 50,000 price list items at one time, specify a custom batch size of 4 products.\nNOTE Alternatively, consider implementing the primary index for all currencies strategy, which evaluates only one price list item per product.\nTo add the required updates to your org, install the appropriate patch for your version of B2B Commerce for Visualforce:\nTIP Follow the steps in Upgrade the B2B Commerce for Visualforce Managed Package. Select the appropriate installation URL for your version and org type.\nVERSION\tPATCH\nWinter ’21 (version 4.13)\tRelease build\nSpring ’20 (version 4.12)\t3.147.7\nSummer ’18 (version 4.9)\t3.136.39\nIf you're using B2B Commerce for Visualforce Summer ’18 (version 4.9), create the required configuration metadata. Complete the steps in Create Metadata for Configurations Added in a Patch.\nTo override the default batch size, update your storefront configuration settings.\nOn the CC Admin tab in your org, select your storefront (1).\nIn the Storefront Settings menu, select Configuration Settings (2).\nFrom the Module picklist, select Product Indexing (3).\nFind the Override Default Batch Size configuration (4), and click Override (5).\nIn the New Page Setting window, enter TRUE for Value, and click Create.\nFind the Custom Batch Size configuration (6), and click Override (7).\nTIP If the configuration doesn't exist, click New .\nIn the New Page Setting window, enter an integer for your custom batch size for Value, and click Create.\nTIP This value is the maximum number of products whose price list items are evaluated in each batch job.\nBuild and activate a new configuration cache.\nRefresh your product index records. Make sure to select Refresh All before you click Refresh Product Index.\nSEE ALSO\nStrategies for Managing Price List Item Currencies with Product Index Records\nTranslate Storefront Text for Buyers in Different Locales\nManage Prices for Storefront Products with Price Lists\n(Salesforce Developers) ccrz_ccProductIndexBuilder_build\n(Salesforce Developers) Execution Governors and Limits\nDID THIS ARTICLE SOLVE YOUR ISSUE?\nLet us know so we can improve!\nYes\nNo\n ",
    "title": "Optimizing Product Indexing for B2B Commerce",
    "keywords": [
        "Salesforce B2B Commerce",
        "Product Indexing",
        "Apex Governor Limits",
        "batch size calculation",
        "product records",
        "price list items",
        "currencies",
        "locales"
    ],
    "links": [
        "https://help.salesforce.com/sfsites/c/resource/HTCommunityCustomJS/HC_TbidAuth.js",
        "https://help.salesforce.com/s/support\",\"target\":\"_self\",\"label\":\"Contact",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_visualforce.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_start.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_install.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_setup.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_setup_community_users.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_setup_self_register.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_setup_sharing_rules.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_admin.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_admin_global.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_storefront_data.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_settings_loader.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_admin_storefront.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_configuration.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_configuration_settings.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_product.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_product_types.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_product_dynamic_kit.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_product_image.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_discovery.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_category.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_category_media.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_spec.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_product_index.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_sell.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_price_list.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_promotion.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_coupon.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_buyer.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_account_group.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_effective_account.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_purchase.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_cart_scale.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_storefront_ux.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_pages.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_home.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_checkout.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_my_account.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_product_compare.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_product_detail.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_product_list.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_scaled_cart.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_shopping_cart.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_site_login.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_site_register.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_components.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_components_effective_account_selector.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_components_feature_filtering.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_components_spotlight_featured_products.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_page_labels.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_menu.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_theme.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_extension.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_storefront.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_localize.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_seo.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_seo_friendly_urls.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_seo_bot_pages.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_lwc.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_trust.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_shield.htm&language=en_US&type=5",
        "https://help.salesforce.com/s?language=en_US",
        "https://help.salesforce.com/s/articleView?id=sf.overview_edition_lex_only.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_locales.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_product_index_currency.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_product_index_currency.htm&language=en_US&type=5#b2b_commerce_master_index_all_currencies",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_upgrade_managed_package.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_install_urls.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_rn_2020_spring_patches.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_rn_2018_summer_patches.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_rn_2018_summer_patches_config.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.b2b_commerce_configuration_cache.htm&language=en_US&type=5"
    ],
    "embedding": [
        -0.45384731888771057,
        -0.033323734998703,
        -0.34844520688056946,
        -0.3161645829677582,
        -0.6090273261070251,
        0.6427173614501953,
        -1.1060471534729004,
        -0.03466702997684479,
        -0.37668752670288086,
        -0.45295023918151855,
        0.29350244998931885,
        -0.4705471992492676,
        -0.10703666508197784,
        -0.27080294489860535,
        -0.40383180975914,
        -0.2116597294807434,
        0.002006620168685913,
        0.20457646250724792,
        0.5410089492797852,
        0.4208206534385681,
        0.20077690482139587,
        0.6378235816955566,
        0.8227875232696533,
        -0.4273419976234436,
        0.23358438909053802,
        -0.6734817028045654,
        -0.09245137870311737,
        -0.04530678316950798,
        0.15560513734817505,
        0.47612902522087097,
        -0.6412590146064758,
        0.024952590465545654,
        0.14779523015022278,
        -0.5445077419281006,
        0.0380559042096138,
        -0.37699419260025024,
        0.018054712563753128,
        -1.1628767251968384,
        -0.07424138486385345,
        0.4236569404602051,
        -0.4529532492160797,
        0.1077709048986435,
        0.26901793479919434,
        0.3885515034198761,
        0.014002211391925812,
        0.07650165259838104,
        0.0726516917347908,
        0.11879323422908783,
        0.5684643983840942,
        0.37658119201660156,
        -0.4016018211841583,
        0.12518233060836792,
        0.19201534986495972,
        -0.7354989647865295,
        0.012400674633681774,
        -0.1843496859073639,
        -0.11611326038837433,
        -1.1164467334747314,
        0.4788821339607239,
        -0.6375418305397034,
        0.35586586594581604,
        0.7019813656806946,
        0.4232829213142395,
        -0.8114252090454102,
        0.11051537096500397,
        0.3221561014652252,
        -0.22337937355041504,
        -0.4100131392478943,
        0.7761760354042053,
        -0.4390777349472046,
        -0.618787944316864,
        -0.4458886384963989,
        -0.28974223136901855,
        0.4259474575519562,
        0.13860292732715607,
        -0.5045633912086487,
        -0.06119987368583679,
        -0.0741855800151825,
        -0.4377398192882538,
        -0.21012534201145172,
        -0.3377137780189514,
        -0.20553666353225708,
        -0.43109750747680664,
        -0.517367422580719,
        -0.24537380039691925,
        1.0246400833129883,
        -0.2700863778591156,
        0.6051560044288635,
        0.18674322962760925,
        0.0728379487991333,
        0.19009555876255035,
        0.8234149217605591,
        0.8880977630615234,
        0.6442274451255798,
        0.7121270895004272,
        0.8924943804740906,
        0.7612105011940002,
        -0.0645345002412796,
        0.4135308563709259,
        -0.21742349863052368,
        0.08187070488929749,
        0.45294299721717834,
        -0.13775262236595154,
        -0.18378686904907227,
        -0.35329508781433105,
        -0.6999812722206116,
        -0.2837192416191101,
        0.508064866065979,
        -0.43215975165367126,
        -0.3635641932487488,
        -0.005558736622333527,
        0.1603110432624817,
        -1.2366396188735962,
        -0.16716113686561584,
        -0.4185274541378021,
        0.28207647800445557,
        -0.6819221377372742,
        0.23921877145767212,
        0.25907522439956665,
        -0.3784809410572052,
        4.319311618804932,
        0.17297866940498352,
        0.5555436611175537,
        0.6584880948066711,
        0.7337085604667664,
        0.7305987477302551,
        -0.09065176546573639,
        -0.5465512275695801,
        0.18544897437095642,
        -1.0043846368789673,
        -0.46711570024490356,
        -0.8335874080657959,
        0.19586235284805298,
        0.9418656229972839,
        -0.545441746711731,
        0.33473989367485046,
        -0.7493530511856079,
        0.2608723044395447,
        1.1895344257354736,
        -0.7752810120582581,
        -1.086268424987793,
        0.2938583791255951,
        0.35276246070861816,
        1.151667833328247,
        0.12031190097332001,
        0.3700488209724426,
        -0.24030646681785583,
        -0.2629662752151489,
        -0.368192583322525,
        -0.1409337967634201,
        0.7080497145652771,
        -0.10682482272386551,
        0.5848976969718933,
        -0.13315340876579285,
        -0.049232907593250275,
        0.6623088717460632,
        0.3025089204311371,
        0.3270038962364197,
        0.6391029953956604,
        -0.48420050740242004,
        0.233200341463089,
        0.09791143983602524,
        -0.776256263256073,
        0.13125620782375336,
        0.08021333813667297,
        0.3390289843082428,
        0.5958412885665894,
        0.44654300808906555,
        0.5225992798805237,
        -0.17470993101596832,
        0.9289955496788025,
        -0.6277693510055542,
        0.25564661622047424,
        -0.03525380790233612,
        -0.9251878261566162,
        0.13446210324764252,
        -0.30352461338043213,
        -0.5586776733398438,
        -0.026431605219841003,
        0.17861995100975037,
        0.9018644690513611,
        -0.149616077542305,
        0.10183116793632507,
        0.21470651030540466,
        -0.47609061002731323,
        -0.041531264781951904,
        -0.0017822831869125366,
        0.30939891934394836,
        0.06394097208976746,
        -0.555107831954956,
        0.6260043978691101,
        -0.7933822274208069,
        -1.1854422092437744,
        0.0018816888332366943,
        -0.5838214159011841,
        -0.2774837613105774,
        -0.16436107456684113,
        -0.0008348999544978142,
        0.029427217319607735,
        -0.9028406739234924,
        -0.20005428791046143,
        -0.055492423474788666,
        0.5329922437667847,
        0.3461122512817383,
        0.31855106353759766,
        0.19490866363048553,
        -0.9241340160369873,
        0.46130460500717163,
        0.05214020609855652,
        -0.453268826007843,
        -0.34090447425842285,
        1.0253047943115234,
        -0.49728095531463623,
        -0.29574623703956604,
        0.4060719311237335
    ]
}