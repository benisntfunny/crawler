{
    "id": "4292bf5f4dd2aab5dbd3234bb806bfc60476617e9219f5d40e6936b8f1b535bf-part2",
    "url": "https://help.salesforce.com/s/articleView?id=sf.ls_restrict_working_hours_selectively.htm&language=en_US&type=5",
    "content": "nullManage Appointments with Salesforce Scheduler\nTABLE OF CONTENTS\nClose\nClose\nSearch\nSearch\n Manage Appointments with Salesforce Scheduler\n Set Up Salesforce Scheduler and Book Appointments\n Get Started with Salesforce Scheduler\n Implementation Resources for Salesforce Scheduler\n Manage Business Information in Salesforce Scheduler\n Manage Availability and Exceptions in Salesforce Scheduler\n Set Up Operating Hours in Salesforce Scheduler\n Manage Shifts in Salesforce Scheduler\n Considerations for Shifts\n Manage Your Shifts in Schedule View\n Create Shifts in Salesforce Scheduler\n Configure Shift Settings\n Create Shifts in Bulk by Using a CSV File\n Engagement Channel Types\n Multiple Topics for Shifts\n Set Up Roles and Hierarchies for Shifts\n Create Record Types for Shift Statuses\n Determine Appointment Time Slots with Shifts\n Set Up Approval Process for Shifts\n Restrict Service Resources from Modifying Shifts for Two Weeks with...\n Restrict Working Hours Selectively\n Appointment Distribution\n Enable and Configure Concurrent Scheduling\n Enable and Configure Multi-Resource Scheduling\n Service Resource Absences in Salesforce Scheduler\n Set Up Holidays in Salesforce Scheduler\n Check Calendars to Determine Availability of Service Resources\n Determine Service Resource Availability by Work Type Groups\n Define Rules for Finding Appropriate Service Resources in Salesforce...\n How Salesforce Scheduler Determines Available Time Slots\n Customize Appointment Booking in Salesforce Scheduler\n Configure Appointment Email Notifications with the ICS File\n Enable Users to Create and Manage Appointments in Salesforce Scheduler\n Show Appointments as Events on Salesforce or External Calendars\n Troubleshoot Issues with Appointment Scheduling\n Extend Salesforce Scheduler Functionality with Salesforce Products...\n\nYou are here:\n\nSALESFORCE HELP\nDOCS\nSALESFORCE SCHEDULER\nRestrict Working Hours Selectively\n\nIf you enable the Use service territory’s operating hours with shifts scheduling policy, Salesforce Scheduler uses the intersection of shifts and service territory operating hours to determine the availability of all service resources. However, if you want to restrict working hours to service territory operating hours only for a few service resources, use triggers.\n\nREQUIRED EDITIONS\nAvailable in: Lightning Experience.\nAvailable in: Enterprise and Unlimited Editions\n\nFirst, create a custom boolean field, OvertimeEnabled, to specify the resources that can work beyond the service territory operating hours. Next, change scheduling policies so that only shifts of service territory members are used to determine the availability of service resources for appointments. Then, create an Apex trigger on the Shift object that runs before a Shift is created and updated. The trigger validates shift timings and ensures that shift timings are within service territory operating hours for resources whose OvertimeEnabled field value is false.\n\nFrom the object management settings for Service Resource, go to Fields & Relationships.\nClick New.\nSelect Checkbox, and then click Next.\nIn the Field Label field, enter OvertimeEnabled, and then click Next.\nSet up field-level security and provide access to the necessary profiles, and then click Next.\nSave your changes.\nFrom Setup, in the Quick Find box, enter Scheduling Policies, and then select Scheduling Policies.\nSelect Use service territory member’s shift scheduling policy, and then deselect Use service territory’s operating hours with shifts scheduling policy.\nFrom the object management settings for shift, go to Triggers.\nClick New.\nReplace the default code with this code.\ntrigger ShiftValidation on Shift (before insert, before update) {\n    List<Shift> shifts = Trigger.new;\n\n    Set<String> sr = new Set<String>();\n    for(Shift shift: shifts) {\n        sr.add(shift.ServiceResourceId);\n    }\n    \n    List<ServiceResource> extendedSr = [SELECT Id FROM ServiceResource WHERE  OvertimeEnabled__c = False AND Id IN :sr];\n    \n    Set<String> srIds = new Set<String>();\n    for(ServiceResource sr1: extendedSr) {\n        srIds.add(sr1.Id);\n    }\n    \n    Set<Shift> confirmedShifts = new Set<Shift>();\n    Set<String> territoryIds = new Set<String>();\n    //We will only run this validation for Shifts with Status Category = \"Confirmed\" AND Service Resource can work extended hours\n    for(Shift shift: shifts) {\n        if(shift.StatusCategory == 'Confirmed' && srIds.contains(shift.ServiceResourceId)) {\n            confirmedShifts.add(shift);\n            territoryIds.add(shift.ServiceTerritoryId);\n        }\n    }\n\n    if(confirmedShifts.size() > 0) {\n        //Get all Service Territory IDs along with their OperatingHourId\n        ServiceTerritory[] territoryIdsWithOperatingHours = [SELECT Id, OperatingHoursId FROM ServiceTerritory WHERE Id IN :territoryIds];\n\n        Set<String> operatingHourIds = new Set<String>();\n        for(ServiceTerritory st: territoryIdsWithOperatingHours) {\n            //Service Territory may not have Operating Hour defined\n            if(st.OperatingHoursId != null) {\n                operatingHourIds.add(st.OperatingHoursId);\n            }\n        }\n\n        //Get Timeslot information for all Operating Hours got in previous step. We disregard all STM level concurrent timeslots (Shifts with MaxAppointments set to 1)\n        TimeSlot[] timeSlots = [SELECT Id, DayOfWeek, StartTime, EndTime, OperatingHoursId FROM TimeSlot WHERE MaxAppointments = 1 AND OperatingHoursId IN :operatingHourIds];\n\n        //Complex data structure to store Working hours for all Service territories. We will store empty inner map in case Service Territory does not have Operating Hour defined\n        Map<String, Map<String, TimeSlot>> serviceTerritoryWithTimeSlotsPerDay = new Map<String, Map<String, TimeSlot>>();\n\n        for(ServiceTerritory territory: territoryIdsWithOperatingHours) {\n            Map<String, TimeSlot> timeSlotsPerDay = new Map<String, TimeSlot>();\n\n            for(TimeSlot timeSlot: timeSlots) {\n                if(timeslot.OperatingHoursId == territory.OperatingHoursId) {\n                    timeSlotsPerDay.put(TimeSlot.DayOfWeek.substring(0,3), TimeSlot);\n                }\n            }\n            serviceTerritoryWithTimeSlotsPerDay.put(territory.Id, timeSlotsPerDay);\n        }\n\n        //Main validation logic for all confirmed shifts\n        for(Shift s: confirmedShifts) {\n            String dayOfShiftStart = ((Datetime) s.StartTime).format('E').substring(0,3);\n            String dayOfShiftEnd = ((Datetime) s.EndTime).format('E').substring(0,3);\n\n            Map<String, TimeSlot> slots = serviceTerritoryWithTimeSlotsPerDay.get(s.ServiceTerritoryId);\n\n            if(dayOfShiftStart != dayOfShiftEnd) {\n                s.addError('Shift should be within Service Territory\\'s Operating hours ');\n            } else if(slots.get(dayOfShiftStart) == null || slots.get(dayOfShiftEnd) == null) {\n                s.addError('Operating Hours for Service Territory not set up correctly');\n            }else if(s.StartTime.time() < slots.get(dayOfShiftStart).StartTime || s.EndTime.time() > slots.get(dayOfShiftEnd).EndTime) {\n                s.addError('Shift should be within Service Territory\\'s Operating hours ');\n            }\n        }\n    }\n}\n\nSave your changes.\nDID THIS ARTICLE SOLVE YOUR ISSUE?\nLet us know so we can improve!\nYes\nNo\n ",
    "title": "Restricting Working Hours in Salesforce Scheduler",
    "keywords": [
        "salesforce scheduler",
        "working hours restriction",
        "shift validation",
        "service resource management",
        "apex trigger",
        "custom boolean field",
        "field-level security",
        "scheduling policy"
    ],
    "links": [
        "https://help.salesforce.com/sfsites/c/resource/HTCommunityCustomJS/HC_TbidAuth.js",
        "https://help.salesforce.com/s/support\",\"target\":\"_self\",\"label\":\"Contact",
        "https://help.salesforce.com/s/articleView?id=sf.ls_overview.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_get_started_with_salesforce_scheduler.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_licenses_for_salesforce_scheduler.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_implementation_resources_for_salesforce_scheduler.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_st.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_virtual_territories.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_service_resources.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_asset_scheduling_overview.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_share_appnt_with_srvc_resources.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_wtg_wt.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_manage_data_translations.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_manage_availability_and_exceptions.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_oh.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_manage_shifts.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_engagement_channels.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_prereqs_for_using_engagement_channels.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_multiple_topics_for_shifts.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_roles_and_hierarchies.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_create_record_types_for_shift_status.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_determine_time_slot_with_shifts.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_shift_approval_process.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_create_approval_process.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_appointment_distribution.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_enable_appointment_distribution.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_concurrent.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_multiresource.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_holiday.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_read_calendars_overview.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_read_external_events_overview.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_overview_operating_hours_for_STM_for_WTGs.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_scheduling_policies_overview.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_how_are_time_slots_determined.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_customize_appointment_booking_experience.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_flow_screen_customizations.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_flow_screen_comp_attributes.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_auto_assgnmnt_anonymous_schdlng.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_manage_settings.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_manage_time_zones.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_configure_email_notification_with_ics.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_assign_service_rsrc_as_email_recipients.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_enable_users_to_create_and_manage_appointments.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_appointment_statuses_and_status_categories_in_salesforce_scheduler.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_video_appnts_with_chime.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_add_my_appointments_utility_item.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_configure_email_for_unauthenticated_users.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_distribute_outbound_flows.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_group_service_appointments.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_work_with_appointments.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_inbound_scheduling.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_inbound_overview.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_guest_users.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_set_up_modifying_guest_appointments.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_work_with_inbound_appointments.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_manage_appointments_for_guest_users.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_share_srvc_resource_availability_using_invitation_url.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_send_appt_invt_url_using_actionable_list.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_lobby_management.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_lobby_management_for_scheduled_appointments.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_lobby_management_for_drop_in_appointments.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_manage_waitlists.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_drop_in_participants.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_attend_drop_in_participants_using_my_appmnts_console.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_event_mgmt_overview.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_enable_event_mgmt.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_multi_attendee_event.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_troubleshoot_appointment_scheduling_issues.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_troubleshoot_issues_with_setup_and_appointment_scheduling.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_troubleshoot_unavailable_time_slots.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_identify_validation_issues_with_records.htm&language=en_US&type=5",
        "https://help.salesforce.com/s/articleView?id=sf.ls_functional_checklist_to_troubleshoot_flow_screens.htm&language=en_US&type=5",
        "https://help.salesforce.com/s?language=en_US"
    ],
    "embedding": [
        -0.2915045917034149,
        -0.7928359508514404,
        -1.3975094556808472,
        -1.0005308389663696,
        0.5198439359664917,
        0.4961255192756653,
        0.7782006859779358,
        -0.3887304365634918,
        -0.2467118501663208,
        -0.2588029205799103,
        -0.3586047887802124,
        0.002616270910948515,
        0.7348706126213074,
        0.5702251195907593,
        0.3734104633331299,
        0.6229743957519531,
        -0.23707550764083862,
        -0.458482563495636,
        -1.3080310821533203,
        -0.6800071001052856,
        0.2278054654598236,
        -0.514633059501648,
        0.4054311215877533,
        -0.5649511218070984,
        -0.4582520127296448,
        0.5971770286560059,
        0.8408876657485962,
        -0.380107581615448,
        -0.07411321997642517,
        0.6355193853378296,
        0.5053974986076355,
        0.1451205164194107,
        -0.4558679461479187,
        0.050453461706638336,
        -0.0902172327041626,
        0.47351858019828796,
        -0.08949249982833862,
        0.5330526828765869,
        0.5216881036758423,
        0.27124106884002686,
        -0.02479507029056549,
        0.7192198038101196,
        0.08283882588148117,
        0.05507686734199524,
        -0.6416579484939575,
        -0.4151937663555145,
        -0.2729523181915283,
        0.5006873607635498,
        0.005256582051515579,
        0.2547454535961151,
        0.4142203629016876,
        -0.44451290369033813,
        0.2810813784599304,
        -1.009358525276184,
        0.09300217777490616,
        -0.5575459003448486,
        -0.09974491596221924,
        0.32478365302085876,
        -0.4096609950065613,
        -0.6158735156059265,
        1.1959047317504883,
        -0.05701380595564842,
        0.06316433846950531,
        0.07552304118871689,
        0.3169616758823395,
        0.0882992148399353,
        0.21447217464447021,
        0.9803364276885986,
        -0.75040602684021,
        -0.5470676422119141,
        -0.3443605303764343,
        -0.4505767226219177,
        -0.38540759682655334,
        -0.49460405111312866,
        -0.25937357544898987,
        -0.676498293876648,
        0.05564294755458832,
        -0.4339984953403473,
        -0.15119214355945587,
        0.6541774272918701,
        -0.25225260853767395,
        -0.3790585994720459,
        0.3352348804473877,
        0.1718767136335373,
        -1.0973398685455322,
        0.33855289220809937,
        0.24505314230918884,
        0.09949983656406403,
        -0.5063544511795044,
        -0.5078466534614563,
        -0.0923425555229187,
        -0.19513384997844696,
        0.013905060477554798,
        -0.5487840175628662,
        -0.29515108466148376,
        -0.00016248971223831177,
        -0.3513202965259552,
        -0.760080873966217,
        -0.3035750687122345,
        0.07323713600635529,
        -0.5938431024551392,
        -0.5419119596481323,
        -0.07726301997900009,
        0.8337504863739014,
        0.13280172646045685,
        0.2176893651485443,
        0.4739077687263489,
        -0.7938144207000732,
        0.08977220952510834,
        0.5874861478805542,
        1.8144745826721191,
        -0.2759779989719391,
        0.5620712637901306,
        0.008538829162716866,
        -0.027068011462688446,
        0.47623467445373535,
        -0.6616939306259155,
        -0.22075128555297852,
        -0.480135053396225,
        0.4307345747947693,
        0.5476400256156921,
        -0.8690516948699951,
        -0.8302324414253235,
        -0.008636530488729477,
        -0.16152414679527283,
        -0.19584400951862335,
        -0.14706319570541382,
        0.11510865390300751,
        0.1799282431602478,
        -0.3384501039981842,
        -1.2930110692977905,
        -0.09250780940055847,
        -1.1000332832336426,
        0.2977276146411896,
        -0.11522524058818817,
        0.10326600074768066,
        0.04379509761929512,
        -0.40273579955101013,
        4.043258190155029,
        0.28118300437927246,
        1.0772920846939087,
        0.07341503351926804,
        0.042277753353118896,
        0.8989382982254028,
        0.17758238315582275,
        0.28030526638031006,
        0.789350152015686,
        -0.4152645468711853,
        -0.005656231194734573,
        -0.1885027438402176,
        -0.17376846075057983,
        0.7269068360328674,
        -0.4568641185760498,
        0.5284397602081299,
        -0.9378544092178345,
        0.10450169444084167,
        1.0586434602737427,
        -0.4833294153213501,
        -0.8320990800857544,
        0.1996956616640091,
        1.0103347301483154,
        0.928290069103241,
        -0.3328588306903839,
        0.2439916431903839,
        0.07307246327400208,
        -0.4005459249019623,
        -0.8713304996490479,
        -0.29589807987213135,
        0.13870806992053986,
        -0.980320394039154,
        0.5530164837837219,
        0.5467999577522278,
        0.8149820566177368,
        0.3671249449253082,
        0.384090393781662,
        0.35678696632385254,
        -0.3397883176803589,
        -1.082696557044983,
        0.006819635629653931,
        0.6425594091415405,
        -0.5288353562355042,
        0.28861331939697266,
        0.25017616152763367,
        0.2592615783214569,
        0.3057948350906372,
        -0.20402240753173828,
        0.8273621797561646,
        0.10185769200325012,
        0.7211049795150757,
        -0.2821881175041199,
        0.7758706212043762,
        -0.2647725045681,
        -0.8612117171287537,
        0.6152257323265076,
        0.15930017828941345,
        -0.4595739543437958,
        -0.2807435989379883,
        -0.40626299381256104,
        0.4717499315738678,
        0.2085821032524109,
        -0.34282541275024414,
        -0.035401105880737305,
        -0.8531801104545593,
        0.08403390645980835,
        -0.3203805983066559,
        0.5172955989837646,
        -0.4497081935405731,
        0.244068443775177,
        -0.012819546274840832,
        -0.2493818700313568,
        -0.3673214912414551,
        -0.0684472918510437,
        -0.1355484127998352,
        -0.23890136182308197,
        -0.4335818588733673,
        0.49754148721694946,
        0.3843863010406494,
        -0.5992093682289124,
        0.47368568181991577,
        0.44239115715026855,
        0.13074496388435364,
        0.04448629915714264,
        0.6832821369171143,
        0.2885700464248657,
        -0.7664968371391296,
        -0.3110930025577545,
        -0.30353325605392456,
        -0.47726142406463623,
        0.23144114017486572,
        1.0171377658843994,
        -0.06819962710142136,
        -0.7596612572669983,
        -0.21929657459259033
    ]
}